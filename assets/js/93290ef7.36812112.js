"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6256],{43484:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>c,default:()=>m,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"data_utilities/advanced_code_snippets/vrs_to_mp4","title":"Export VRS to MP4 (Python)","description":"The vrstomp4 script enables you to create an MP4 video from a Project Aria VRS recording.","source":"@site/docs/data_utilities/advanced_code_snippets/vrs_to_mp4.mdx","sourceDirName":"data_utilities/advanced_code_snippets","slug":"/data_utilities/advanced_code_snippets/vrs_to_mp4","permalink":"/projectaria_tools/docs/data_utilities/advanced_code_snippets/vrs_to_mp4","draft":false,"unlisted":false,"editUrl":"https://github.com/facebookresearch/projectaria_tools/tree/main/website/docs/data_utilities/advanced_code_snippets/vrs_to_mp4.mdx","tags":[],"version":"current","sidebarPosition":30,"frontMatter":{"sidebar_position":30,"title":"Export VRS to MP4 (Python)"},"sidebar":"tutorialSidebar","previous":{"title":"Image Utilities (Python and C++)","permalink":"/projectaria_tools/docs/data_utilities/advanced_code_snippets/image_utilities"},"next":{"title":"Collaborative Tools","permalink":"/projectaria_tools/docs/collaborative_tools"}}');var n=a(74848),i=a(28453),o=a(49489),s=a(7227);const l={sidebar_position:30,title:"Export VRS to MP4 (Python)"},c="Export a VRS file to MP4",u={},d=[{value:"Install dependencies",id:"install-dependencies",level:2},{value:"Usage",id:"usage",level:2},{value:"MISC",id:"misc",level:2},{value:"Extract VRS timestamps from MP4",id:"extract-vrs-timestamps-from-mp4",level:3},{value:"Calibration for upright RGB",id:"calibration-for-upright-rgb",level:3}];function p(e){const t={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"export-a-vrs-file-to-mp4",children:"Export a VRS file to MP4"})}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"vrs_to_mp4"})," script enables you to create an MP4 video from a Project Aria VRS recording.\nBy default, it uses RGB as well as audio streams (if present).\nThe MP4 video will have the same framerate as the RGB stream in the VRS file and use H264 and MP3 7 (or 2) channel encoding for video and audio.\nIf a dropped frame is present in the VRS recording (a frame could be missing at a given expected timestamp), the closest valid frame will be copied over until the next valid frame."]}),"\n",(0,n.jsx)(t.admonition,{title:"vrs_to_mp4 generates a recording preview",type:"info",children:(0,n.jsx)(t.p,{children:"This script provides video preview. It is not designed to create a video file suitable for Computer Vision applications."})}),"\n",(0,n.jsx)(t.h2,{id:"install-dependencies",children:"Install dependencies"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"python3 -m pip install projectaria_tools moviepy\n"})}),"\n",(0,n.jsx)(t.h2,{id:"usage",children:"Usage"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"vrs_to_mp4"})," tool is available via command line or through Python as a library."]}),"\n",(0,n.jsxs)(o.default,{groupId:"programming-language",children:[(0,n.jsx)(s.default,{value:"python",label:"Python",children:(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-python",children:"from projectaria_tools.utils.vrs_to_mp4_utils import convert_vrs_to_mp4\nconvert_vrs_to_mp4(input_vrs, output_video, log_folder, down_sample_factor)\n"})})}),(0,n.jsx)(s.default,{value:"bash",label:"Bash",children:(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:'vrs_to_mp4 --vrs "projectaria_tools/data/mps_sample/sample.vrs" --output_video "sample.mp4"\n'})})})]}),"\n",(0,n.jsx)(t.h2,{id:"misc",children:"MISC"}),"\n",(0,n.jsx)(t.h3,{id:"extract-vrs-timestamps-from-mp4",children:"Extract VRS timestamps from MP4"}),"\n",(0,n.jsxs)(t.p,{children:["Historically, when VRS files were converted to MP4, accurate timestamp information was lost.\nTo maintain compatibility with the rest of our tooling, this tool now logs a VRS timestamp for each MP4 frame. VRS timestamps are saved to the MP4's metadata and are measured in nanoseconds.\nNow for every MP4 extracted using ",(0,n.jsx)(t.code,{children:"vrs_to_mp4"})," tools, this timestamp is conveniently saved as a metadata."]}),"\n",(0,n.jsxs)(t.p,{children:["To extract the vrs timestamps, use the ",(0,n.jsx)(t.code,{children:"get_timestamp_from_mp4"})," function.\nThe resulting timestamp is in ",(0,n.jsx)(t.code,{children:"TimeDomain.DEVICE_TIME"})]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-Python",children:"from projectaria_tools.utils.vrs_to_mp4_utils import get_timestamp_from_mp4\nvrs_device_timestamps_nanoseconds = get_timestamp_from_mp4(mp4_file)\n"})}),"\n",(0,n.jsx)(t.h3,{id:"calibration-for-upright-rgb",children:"Calibration for upright RGB"}),"\n",(0,n.jsx)(t.p,{children:"The output RGB frames in the MP4 file are rotated upright (clockwise 90 degrees).\nThe camera calibration will be changed after such rotation and can be obtained using the following interface."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-Python",children:"from projectaria_tools.utils.calibration_utils import (\n    rotate_upright_image_and_calibration,\n)\nupright_image, upright_calibration = rotate_upright_image_and_calibratio(original_rgb_image, rgb_camera_calibration)\n"})})]})}function m(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(p,{...e})}):p(e)}},7227:(e,t,a)=>{a.r(t),a.d(t,{default:()=>o});a(96540);var r=a(34164);const n={tabItem:"tabItem_Ymn6"};var i=a(74848);function o(e){let{children:t,hidden:a,className:o}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,r.A)(n.tabItem,o),hidden:a,children:t})}},49489:(e,t,a)=>{a.r(t),a.d(t,{default:()=>y});var r=a(96540),n=a(34164),i=a(24245),o=a(56347),s=a(36494),l=a(62814),c=a(45167),u=a(69900);function d(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:t,children:a}=e;return(0,r.useMemo)((()=>{const e=t??function(e){return d(e).map((e=>{let{props:{value:t,label:a,attributes:r,default:n}}=e;return{value:t,label:a,attributes:r,default:n}}))}(a);return function(e){const t=(0,c.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function m(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:a}=e;const n=(0,o.W6)(),i=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,l.aZ)(i),(0,r.useCallback)((e=>{if(!i)return;const t=new URLSearchParams(n.location.search);t.set(i,e),n.replace({...n.location,search:t.toString()})}),[i,n])]}function f(e){const{defaultValue:t,queryString:a=!1,groupId:n}=e,i=p(e),[o,l]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=a.find((e=>e.default))??a[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:i}))),[c,d]=h({queryString:a,groupId:n}),[f,v]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,i]=(0,u.Dv)(a);return[n,(0,r.useCallback)((e=>{a&&i.set(e)}),[a,i])]}({groupId:n}),_=(()=>{const e=c??f;return m({value:e,tabValues:i})?e:null})();(0,s.A)((()=>{_&&l(_)}),[_]);return{selectedValue:o,selectValue:(0,r.useCallback)((e=>{if(!m({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),v(e)}),[d,v,i]),tabValues:i}}var v=a(11062);const _={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=a(74848);function g(e){let{className:t,block:a,selectedValue:r,selectValue:o,tabValues:s}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.a_)(),u=e=>{const t=e.currentTarget,a=l.indexOf(t),n=s[a].value;n!==r&&(c(t),o(n))},d=e=>{let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const a=l.indexOf(e.currentTarget)+1;t=l[a]??l[0];break}case"ArrowLeft":{const a=l.indexOf(e.currentTarget)-1;t=l[a]??l[l.length-1];break}}t?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,n.A)("tabs",{"tabs--block":a},t),children:s.map((e=>{let{value:t,label:a,attributes:i}=e;return(0,b.jsx)("li",{role:"tab",tabIndex:r===t?0:-1,"aria-selected":r===t,ref:e=>l.push(e),onKeyDown:d,onClick:u,...i,className:(0,n.A)("tabs__item",_.tabItem,i?.className,{"tabs__item--active":r===t}),children:a??t},t)}))})}function x(e){let{lazy:t,children:a,selectedValue:i}=e;const o=(Array.isArray(a)?a:[a]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===i));return e?(0,r.cloneElement)(e,{className:(0,n.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:o.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==i})))})}function j(e){const t=f(e);return(0,b.jsxs)("div",{className:(0,n.A)("tabs-container",_.tabList),children:[(0,b.jsx)(g,{...t,...e}),(0,b.jsx)(x,{...t,...e})]})}function y(e){const t=(0,v.default)();return(0,b.jsx)(j,{...e,children:d(e.children)},String(t))}},28453:(e,t,a)=>{a.d(t,{R:()=>o,x:()=>s});var r=a(96540);const n={},i=r.createContext(n);function o(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);